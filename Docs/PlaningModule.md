# PlaningModule Readme

## 1. Associated user stories

* **US 6.1.4** - As Admin I want the information about healthcare staff, operation types, and operation requests used in the planning module to be in sync with the information entered in the backoffice module. (#29)

* **US 6.1.5** - As Admin I want the information about staff’s availability and operation schedule to be in sync with the plan generated by the planning module. (#30)

* **US 6.3.1** - As an Admin, I want to obtain the better scheduling of a set of operations (surgeries) in a certain operation room on a specific day. The better scheduling is considered as the sequence of operations that finishes early. Note that surgeries have constraints (e.g. number of doctors or other staff), namely concerning the time availability of staff during the day. The approach may be generating all surgeries’ sequences and selecting the better, and this is possible till a certain dimension (number of surgeries). The user must have a user interface to start the process (enter any additional parameters the planning algorithm needs, e.g., room number, date). The system will then generate the plan and show it to the user on the screen. It is acceptable that the UI blocks while waiting for the planning module response. (#52)

* **US 6.3.2** - As an Admin, I want to know till what dimension in terms of number of surgeries is possible to ask for the better solution. Perform a complexity analysis of the problem to understand to which dimension it is feasible to ask for the better solution. Document your results and findings. (#53)

* **US 6.3.3** - As an Admin, I want to obtain a good schedule, not necessarily the better, in useful time to be adopted. The system generates a "good" (non-optimal but efficient) schedule using heuristics or informed methods (e.g., greedy algorithms, rule-based scheduling). The system prioritizes generating a schedule that is close to optimal but does so within a reasonable time frame (e.g., under 30 seconds). The user must have a user interface to start the process (enter any additional parameters the planning algorithm needs, e.g., room number, date, which heuristic to use). The system will then generate the plan and show it to the user on the screen. It is acceptable that the UI blocks while waiting for the planning module response. (#54)

------------------------------------------------

## 2. Customer specifications and clarifications

**[data]**

* **Question:** 

  * **Answer:** 

**[2 de November de 2024]**

* **Question:** When should the human body be lying on the table? if at this precise moment there is a surgery going on? or if there are surgeries going to happen that day?

  * **Answer:** If and only if there is a surgery going on on that precise room at that precise moment.

**[5 de November de 2024]** 

* **Question:** By my understanding, heuritics are problem-solving methods or strategies designed to find a "good enough" solution. I assume that we must have some directing regarding what of these stratagies are.

Is there any specific heuristics or criteria you want us to be used to find a good enough solution? Like the priority of each operation or the time they take?

  * **Answer:** Consider the example of the Travel Salesman Problem (TSP) illustrated in the first ALGAV TP class to support the practical work. In that case the heurist is to visit the city not visited yet more close to the last city visited. The idea is that when the dimention of the problemnis high, and to generate all sequences to select the best is not feasible, we will find a way to generate one solution that isgood enough, but not the better.
In the case of surgeries it may be that the next operation is that involving the doctor that is available early, or the doctor with more surgeries not done yet. The heuristic will be good for some cases, not for others.
But in spite of involving just the doctor it may consider other staff for the surgery as well.
You can test the heuristic for cases with dimentions that are availsble for generating all solutions and compare the result using the heuristic and the better solution

**[6 de November ]** 

* **Question:** I have a question regarding the planning component. Should we consider all the minutes of the day as available for scheduling for a staff member, meaning from minute 0 to 1440, or should we only consider the staff as available during the time slots they input into the system? For example, [12:00-14:00], [18:00-19:00].

  * **Answer:** As in the example we gave in the ALGAV TP classes we can consider a previous staff agenda for each staff member

example: agenda_staff(d001,20241028,[(720,790,m01),(1080,1140,c01)]).

in this example m01 may be a meeting and c01 may be time for consultations, or anything else.

And a timetable is also used

example: timetable(d001,20241028,(480,1200)).

With these 2 things we say that doctor d001 starts to work at 480 (8:00am), has a meeting in the interval 720-790 (12:00-1:10pm), consultations in the interval 1080-1140 (6:00pm-7:00pm), and end work time at 1200 (8:00pm).

We are not considering some constraints like to have X minutes for lunch in a certain period of time (for exmaple 60 minutes in the period 12:00-3:00pm), or to work continuously the maximum of Y hours in surgeries (eg. 7 hours)

   * **Answer:** Please keep in mind that the information between the backoffice module and the planning module must be in sync. that is, there should only be one source of truth.
For instance, the availability slots of the staff might be stored in the backoffice and "imported"/"transferred" to the planning module if and when necessary, eventually applying necessary "translations" between the two subdomains. For example, the slot in the backoffice might have a different representation than the slot in the planning module

**[9 de November de 2024]** 

* **Question:** As was stated previously, the number of rooms in the 3D representation must be consistent with the number of rooms that can be scheduled in the Planning/Optimization Module.

However, let's say that, while we have the 3D representation open, someone creates a new Surgery Room. Must that new room be loaded dynamically?

  * **Answer:** it is not necessary to do it "hot wired".
the next time the 3D view is loaded it should pickup the new surgery room.
keep in mind that creating a new surgery room is not something that happens frequently...

**[12 de November de 2024]** 

* **Question:** Gostaríamos que nos esclarecesse se na US 6.3.1, se é esperado pelo programa sugestões de horários para as cirurgias ou se essas sugestões já devem ser guardadas na base de dados e serem scheduled.

  * **Answer:** o objetivo desse requisito é obter o escalonamento dos pedidos de cirurgia. ou seja, em que dia/hora/sala/etc cada cirurgia deve ser realizada


**[13 de November de 2024]** 

* **Question:** Boa noite, 

O algoritmo que nos foi dado para desenvolver em ALGAV faz uso do seguinte predicado:

  assignment_surgery(so100001,d001).

Isto representa uma marcação, em que so1000001 é o código da cirurgia e d001 é o código do médico.
O algoritmo pega então nestes dados e constrói um horário, mas para isso acontecer, já teríamos que ter informação de que um médico foi atribuído a uma operação.

Não existe nenhuma indicação de como isso seria feito.

Também para SGRAI precisamos de integrar o módulo 3D que mostra a ocupação das salas.
O que também não é possível porque estaria também dependente das marcações e só depois então faria uso dos dados do algoritmo de ALGAV para questões de horas.

  * **Answer:** O exemplo dado em ALGAV assume que já se sabe o staff (p. ex. Médicos) atribuído a cada operação e que isso seria feito manualmente (alguém com competência atribui o staff necessário para cada operação, até porque em alguns casos, sobretudo nos Médicos, isso pode estar associado ao paciente, por exemplo o Médico que tem acompanhado o paciente).

Se a ideia for a de efetuar essa atribuição manualmente fará sentido que haja uma interface para o efeito. Não aparenta que tal deva ser dentro do módulo de planeamento. Mas se for necessário poder-se-á colocar dentro desse módulo, que precisará receber então mais informação (quais os médicos, enfermeiros, outro staff existente, seus detalhes; quais as salas de operações, etc).

Se a ideia for efetuar-se uma atribuição automática poder-se-á criar essa parte do lado do módulo de planeamento. Para cada operação podem-se atribuir os recursos humanos necessários, podendo haver vários para cada função, por exemplo Médico Anestesista ou Ortopedista, Enfermeiro Anestesista ou Circulante, etc. Temos de saber quais estão disponíveis para a data em causa e escolher procurando distribuir a carga por esse staff. Por exemplo, para os ortopedistas d001, d002, d003 e d004 a primeira operação iria para d001, depois a segunda para outro, por exemplo d002, etc. Assim equilibrava-se (ou como se diz "fazia-se o balanceamento") a carga de trabalho entre staffs com a mesma função. Esse balanceamento pode ser em nº de operações, mas também pode ser em termos de tempo visto que as operações demoram tempos diferentes). 

Se for essa a opção aconselho a manterem uma lista de tripletos (nº operações, staff_específico, lista_operações_atribuídas)

Inicialmente essa lista seria por exemplo: [(0,d001,[]),(0,d002,[]),(0,d003,[]),(0,d004,[])]. Se a lista for sendo mantida ordenada, para atribuirmos uma nova operação vemos o elemento à cabeça da lista (definido pelo primeiro elemento de cada tripleto) e esse é atribuído para a próxima operação. A lista ia evoluindo, por exemplo

[(0,d001,[]),(0,d002,[]),(0,d003,[]),(0,d004,[])]

[(0,d002,[]),(0,d003,[]),(0,d004,[]),(1,d001,[so100001])]

[(0,d003,[]),(0,d004,[]),(1,d001,[so100001]),(1,d002,[so100002])]

[(0,d004,[]),(1,d001,[so100001]),(1,d002,[so100002]),(1,d003,[so100003])]

[(1,d001,[so100001]),(1,d002,[so100002]),(1,d003,[so100003]),(1,d004,[so100004])]

[(1,d002,[so100002]),(1,d003,[so100003]),(1,d004,[so100004]),(2,d001,[so100005,so100001])]

[(1,d003,[so100003]),(1,d004,[so100004]),(2,d001,[so100001,so100005]),(2,d002,[so100006,so100002])]

...

Teríamos de repetir para as várias funções (staff) necessárias nas operações

* **Answer:** Bom dia,
como indicado cada grupo pode optar por desenvolver um mecanismo em que manualmente é feita a atribuição de um colaborador a uma cirurgia, ou desenvolver um mecanismo que atribui automaticamente os colaboradores necessarios a cada pedido de cirurgia. cada equipa deve availiar os pros e contras e decidir qual a abordagem que lhe parece mais adequada e com maior probabilidade de sucesso para o projeto.
Em qualquer dos cenários é necessário garantir que para cada cirurgia existem os profissionais necessários de acordo com a especificação do tipo de operação.
No caso da atribuição manual, não é ncessário existir UI

------------------------------------------------

## 3. Acceptance Criteria 

### **_6.1.4_**

- The planning module must sync information about healthcare staff, operation types, operation requests, appointments and surgery rooms with the backoffice module.

------------------------------------------------

### **_6.1.5_**

- The planning module must sync information about staff’s availability and operation schedule with the generated plan.

------------------------------------------------

### **_6.3.1_**

- The system must generate the best scheduling sequence of operations that finishes early.
- The user interface must allow the admin to start the process and enter necessary parameters.
- The system must display the generated plan on the screen.
- The UI can block while waiting for the planning module response.

------------------------------------------------

### **_6.3.2_**

- Perform a complexity analysis to determine the feasible dimension for the best solution.
- Document the results and findings of the complexity analysis.

------------------------------------------------

### **_6.3.3_**

- The system must generate a good schedule using heuristics or informed methods.
- The schedule generation must be completed within a reasonable time frame (e.g., under 30 seconds).
- The user interface must allow the admin to start the process and enter necessary parameters.
- The system must display the generated plan on the screen.
- The UI can block while waiting for the planning module response.

------------------------------------------------

## 4. Input and Output Data

### **_6.1.4_**

* Input Data:
  * Information about healthcare staff, operation types, and operation requests from the backoffice module.
* Output Data:
  * Synced information in the planning module.

------------------------------------------------

### **_6.1.5_**

* Input Data:
  * Staff availability and operation schedule from the planning module.
* Output Data:
  * Synced information in the backoffice module.

------------------------------------------------

### **_6.3.1_**

* Input Data:
  * Parameters for the planning algorithm (e.g., room number, date).
* Output Data:
  * Generated schedule displayed on the screen.

------------------------------------------------

### **_6.3.2_**

* Input Data:
  * Complexity analysis parameters.
* Output Data:
  * Documented results and findings.

------------------------------------------------

### **_6.3.3_**

* Input Data:
  * Parameters for the planning algorithm (e.g., room number, date, heuristic to use).
* Output Data:
  * Generated schedule displayed on the screen.

------------------------------------------------

## 5. Use Cases

------------------------------------------------

## 6. General Information
**_Planning Module:_** Represents the module responsible for scheduling operations in the hospital.

* Attributes:
  * `Healthcare Staff Information` (synced with backoffice module)
  * `Operation Types` (synced with backoffice module)
  * `Operation Requests` (synced with backoffice module)
  * `Staff Availability` (synced with generated plan)
  * `Operation Schedule` (synced with generated plan)
  * `Planning Algorithm` (generates best or good schedules)
  * `User Interface` (for starting the process and displaying the plan)

* Rules:
  * The planning module must sync information with the backoffice module.
  * The planning module must generate the best or good schedule based on the given parameters.
  * The user interface must allow the admin to start the process and display the generated plan.

------------------------------------------------

## 7. Dependency

### **_6.1.4_**
- Depends on the availability of information from the backoffice module.

### **_6.1.5_**
- Depends on the availability of staff availability and operation schedule information.

### **_6.3.1_**
- Depends on the implementation of the planning algorithm.
- Depends on the user interface for starting the process and displaying the plan.

### **_6.3.2_**
- Depends on the complexity analysis of the problem.

### **_6.3.3_**
- Depends on the implementation of heuristics or informed methods for generating a good schedule.
- Depends on the user interface for starting the process and displaying the plan.