# PatientBackend Readme

## 1. Associated user stories

* **US 5.1.3** - As a Patient, I want to register for the healthcare application, so that I can create
  a user profile and book appointments online. **(#3)**

* **US 5.1.4** - As a Patient, I want to update my user profile, so that I can change my personal
  details and preferences. **(#4)**

* **US 5.1.5** - As a Patient, I want to delete my account and all associated data, so that I can
  exercise my right to be forgotten as per GDPR. **(#5)**

* **US 5.1.7** - As a Patient, I want to log in to the healthcare system using my external IAM
  credentials, so that I can access my appointments, medical records, and other
  features securely. **(#7)**

* **US 5.1.8** - As an Admin, I want to create a new patient profile, so that I can register their
  personal details and medical history. **(#8)**

* **US 5.1.9** - As an Admin, I want to edit an existing patient profile, so that I can update their
  information when needed. **(#9)**

* **US 5.1.10** - As an Admin, I want to delete a patient profile,  so that I can remove patients who
  are no longer under car. **(#10)**

* **US 5.1.11** - As an Admin, I want to list/search patient profiles by different attributes, so that I
  can view the details, edit, and remove patient profiles. **(#11)**

------------------------------------------------

## 2. Customer specifications and clarifications

**[04-10-2024]**

* **Question:** In US 5.1.4., what do preferences mean in the patient profile?
  * **Answer:** Preferences are for now related to marketing consent or not by the patient, or other related GDPR preferences.

* **Question:** Can patients update both their user and patient profile information?
  * **Answer:** Patients can update contact information but not medical details. Changes must be verified and validated.

------------------------------------------------

**[07-10-2024]**

* **Question:** It is specified that the admin can input some of the patient's information (name, date of birth, contact information, 
  and medical history). Do they also input the omitted information (gender, emergency contact and allergies/medical condition)? Additionally, 
  does the medical history that the admin inputs refer to the patient's medical record, or is it referring to the appointment history?
  * **Answer:** The admin can not input medical history nor allergies. they can however input gender and emergency contact.

* **Question:** As discussed in a class, there are plenty of filters for the doctors profiles, however im struggling to see what filters 
  can be applied to the patients profiles listing. They can be searched by name, email, date of birth, or medical record number, but 
  everyone has the same role, no specialization, and so on. Can you be a bit more detailed on the filters you're looking to be applied 
  in the patients listings?
  * **Answer:** Users should be able to search students by: name, AND/OR email, AND/OR phone number, AND/OR medical record number, 
  AND/OR date of birth, AND/OR gender listing of users should have the same filters available.

* **Question:** Regarding the editing of patient information, is contact information the only sensitive data? Is it the only data that triggers an email notification?
  * **Answer:** Faz parte das vossas responsabilidades no âmbito do módulo de proteção de dados e de acordo com a politica que venham a definir.

* **Question:** In this US an admin can edit a user profile. Does the system display a list of all users or the admin searchs by ID? Or both?
  * **Answer:** This requirement is for the editing of the user profile. from a usability point of view, the user should be able to start this 
    feature either by searching for a specific user or listing all users and selecting one. Note that we are not doing the user interface of the system 
    in this sprint.

------------------------------------------------

**[10-10-2024]**

* **Question:** When the administrator starts creating the patient profile, what format(s) of the date of birth will they need to enter? 
  Furthermore, what will be the format of the Medical Record Number generated after recording the data?
  * **Answer:** From a usability perspective, dates should be presented to the user using the operating system's locale definitions. Since for this sprint 
    you are building an API, you should use a standard format like ISO 8601. Medical record numbers are generated by the system following the format 
  YYYYMMnnnnnn where YYYY and MM are the year and month of the registration and nnnnnn is a sequential number.

------------------------------------------------

**[14-10-2024]**

* **Question:** When one of the contents that administrator edits is a sensitive content (eg. email), the notification is sent for what patient's email, the 
  email in patient account, the old email of patient or the new email of patient?
  * **Answer:** If the email is changed, the notification should be sent to the "old" email.

------------------------------------------------

**[17-10-2024]**

* **Question:** When generating the audit record to log the deletion of patient profiles what patient information (if any) 
  are we allowed to keep in the log for identification purposes? If none are the logs then only a record of deletion operations 
  and not actually tied to the deletion of a specific patient?
  * **Answer:** The ERS (health regulator) issued an opinion on the retention of health data in which it established a minimum 
    retention period of 5 years, after which the data can be deleted. You may wish to keep some of the information anonymised 
    for statistical purposes only, limiting yourself to, for example, gender and type of surgery.

------------------------------------------------

**[18-10-2024]**

* **Question:** Could you give a concrete example of what a marketing preference would be?
  * **Answer:** Sure. A marketing preference refers to whether a user consents to receiving marketing materials. For example, when 
    a patient registers in the system, they can opt to receive promotional emails or newsletters from the hospital.

* **Question:** Should marketing preferences be associated with a patient’s or staff’s profile, or with the user account itself?
  * **Answer:** This is a design decision based on your understanding of the domain. You'll need to decide if these preferences are linked to the user profile or account.

------------------------------------------------

**[20-10-2024]**

* **Question:** Numa das perguntas realizadas anteriormente, o cliente respondeu que o Admin não pode inserir o medical 
  history. No entanto, no caderno de encargos, nos critérios de aceitação da UC 5.1.8 está escrito o seguinte: "Admins can 
  input patient details such as first name, last name, date of birth, contact information, and medical history." Pode, por 
  favor, esclarecer esta dúvida?
  * **Answer:** considerem a formulaçao "Admins can input patient details such as first name, last name, date of birth 
    and contact information", ignorando o medical history

------------------------------------------------

**[20-10-2024]**

* **Question:** What type contact information should we consider for the patient? just the phone number or more information? 
  Should the contact information be limited to Portuguese domain?
  * **Answer:** The contact information is the email, phone number and address. phone numbers must allow for country code, and 
   addresses must allow for countries other than Portugal. Currently there is no need for the system to validate the postal code.

------------------------------------------------

**[23-10-2024]**

* **Question:** Numa das perguntas realizadas anteriormente, o cliente respondeu que o Admin, aquando da us 5.1.8, apenas pode inserir 
  o first name, last name, date of birth e o contact information. No entanto, no caderno de encargos, nos critérios de aceitação da us 5.1.9 
  está escrito o seguinte: "Editable fields include name, contact information, medical history, and allergies.". Sendo assim, este critério 
  de aceitação não deveria ser apenas os parâmetros que ele próprio inseriu?
  * **Answer:** Sim. devem considerar como critério de aceitação: Editable fields are first name, last name, date of birth and contact information.

------------------------------------------------

## 3. Acceptance Criteria 

### **_5.1.3_**

- Patients can self-register using the external IAM system.
- During registration, patients provide personal details (e.g., name, email, phone) and create a profile.
- The system validates the email address by sending a verification email with a confirmation link.
- Patients cannot list their appointments without completing the registration process.

------------------------------------------------

### **_5.1.4_**

- Patients can log in and update their profile details (e.g., name, contact information, preferences).
- Changes to sensitive data, such as email, trigger an additional verification step (e.g., confirmation email).
- All profile updates are securely stored in the system.
- The system logs all changes made to the patient's profile for audit purposes.

------------------------------------------------

### **_5.1.5_**

- Patients can request to delete their account through the profile settings.
- The system sends a confirmation email to the patient before proceeding with account deletion.
- Upon confirmation, all personal data is permanently deleted from the system within the legally required time frame 
(e.g., 30 days).
- Patients are notified once the deletion is complete, and the system logs the action for GDPR compliance.
- Some anonymized data may be retained for legal or research purposes, but all identifiable information is erased.

------------------------------------------------

### **_5.1.7_**

- Patients log in via an external Identity and Access Management (IAM) provider (e.g., Google, Facebook, or hospital SSO).
- After successful authentication via the IAM, patients are redirected to the healthcare system with a valid session.
- Patients have access to their appointment history, medical records, and other features relevant to their profile.
- Sessions expire after a defined period of inactivity, requiring reauthentication.

------------------------------------------------

### **_5.1.8_**

- Admins can input patient details such as first name, last name, date of birth, contact information. (Corrected by the 
client 21-10-2024 in the Esclarecimento de dúvidas funcionais com o cliente fórum)
- A unique patient ID (Medical Record Number) is generated upon profile creation.
- The system validates that the patient’s email and phone number are unique.
- The profile is stored securely in the system, and access is governed by role-based permissions.

------------------------------------------------

### **_5.1.9_**

- Admins can search for and select a patient profile to edit.
- Editable fields include name, contact information, medical history, and allergies.
- Changes to sensitive data (e.g., contact information) trigger an email notification to the patient.
- The system logs all profile changes for auditing purposes.

------------------------------------------------

### **_5.1.10_**

- Admins can search for a patient profile and mark it for deletion.
- Before deletion, the system prompts the admin to confirm the action.
- Once deleted, all patient data is permanently removed from the system within a predefined time frame.
- The system logs the deletion for audit and GDPR compliance purposes (.

------------------------------------------------

### **_5.1.11_**

- Admins can search patient profiles by various attributes, including name, email, date of birth, or medical record number.
- The system displays search results in a list view with key patient information (name, email, date of birth).
- Admins can select a profile from the list to view, edit, or delete the patient record.
- The search results are paginated, and filters are available to refine the search results.

------------------------------------------------

## 4. Input and Output Data

### **_5.1.3_**

* Input Data:
* Output Data:

------------------------------------------------

### **_5.1.4_**

* Input Data:
  * Updated patient information, including:
    * First, Last  and Full Name
    * Date of Birth
    * Email
    * Contact information
* Output Data:
  * The updated patient profile
  * (In)Success of the operation

------------------------------------------------

### **_5.1.5_**

* Input Data:
  * Email: The Email of the Patient that requested the deletion.
  * Token: The Token sent to the Patient's Email.
* Output Data:
  * (In)Success of the operation.

------------------------------------------------

### **_5.1.7_**

* Input Data:
* Output Data:

------------------------------------------------

### **_5.1.8_**

* Input Data:
    * First Name 
    * Last Name
    * Email
    * Date of Birth
    * Gender
    * Contact Information

* Output data:
    * The patient profile including the Medical Record Number generated.
    * (In)Success of the operation.

------------------------------------------------

### **_5.1.9_**

* Input Data:
  * Patient's unique identifier (e.g., name or ID) for search. 
  * Updated patient information, including:
    * First, Last  and Full Name 
    * Date of Birth
    * Email
    * Contact information
* Output Data:
  * The updated patient profile including the Medical Record Number generated.
  * (In)Success of the operation.

------------------------------------------------

### **_5.1.10_**

* Input Data:
  * Patient's unique identifier (e.g., name or ID).
* Output data:
  * (In)Success of the operation.

------------------------------------------------

### **_5.1.11_**

* Input Data:
  * The name, email, date of birth, medical record number or none depending on the search criteria selected.
* Output data:
  * (In)Success of the operation.
  * List of Patients.

------------------------------------------------

## 5. Use Cases

<p align="center">
  <img src="General_Documentation/UseCaseDiagrams/svg/Patient_UseCaseDiagram.svg" alt="Patient Use Case Diagram">
</p>

------------------------------------------------

## 6. General Information
**_Patient:_** Represents individuals receiving medical care.

* Attributes:
  * `First Name`
  * `Last Name`
  * `Full Name`
  * `Date of Birth`
  * `Gender`
  * `Medical Record Number` (unique identifier)
  * `Contact Information` (email, phone)
  * `Allergies/Medical Conditions` (optional)
  * `Emergency Contact`
  * `Appointment History` (list of previous and upcoming appointments)

* Rules:
  * A patient must be unique in terms of `Medical Record Number`, `Email` and `Phone`. 
  * Sensitive data (like medical history) must comply with GDPR, allowing patients to control their data access.

------------------------------------------------
## 7. Dependency

### **_5.1.3_**
- Depends on the external IAM system for user authentication.

### **_5.1.4_**
- Depends on the patient profile created in US 5.1.3.
- Depends on the email verification system.

### **_5.1.5_**
- Depends on the patient profile created in US 5.1.3.
- Depends on the email notification system.

### **_5.1.7_**
- Depends on the external IAM system for user authentication.
- Depends on the patient profile created in US 5.1.3.

### **_5.1.8_**
- Depends on the admin role and permissions.

### **_5.1.9_**
- Depends on the patient profile created in US 5.1.8.
- Depends on the admin role and permissions.

### **_5.1.10_**
- Depends on the patient profile created in US 5.1.8.
- Depends on the admin role and permissions.

### **_5.1.11_**
- Depends on the patient profiles created in US 5.1.8.
- Depends on the admin role and permissions.